<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Email:Pass Grabber — Clean & Strict</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<style>
  :root{
    --bg:#0a0f1c; --panel:#0e1627; --ink:#e9f0ff; --muted:#97a6c0;
    --neon:#4ff1d6; --neon2:#6b5cff; --line:rgba(255,255,255,0.06);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;background:linear-gradient(180deg,#060b16, #0a0f1c 60%, #0a1324 100%);color:var(--ink);display:flex;justify-content:center;padding:20px}
  .wrap{width:100%;max-width:1100px;display:grid;grid-template-columns:360px 1fr;gap:16px}
  header{grid-column:1/-1;display:flex;align-items:center;gap:12px}
  h1{margin:0;font-size:18px;font-weight:800;letter-spacing:.2px}
  .badge{margin-left:auto;background:linear-gradient(90deg,var(--neon),var(--neon2));color:#031216;padding:6px 10px;border-radius:999px;font-weight:900}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:12px;box-shadow:0 8px 28px rgba(3,8,23,.5);padding:14px}
  .drop{border:2px dashed var(--line);border-radius:10px;padding:16px;text-align:center;cursor:pointer;user-select:none}
  .drop.drag{background:linear-gradient(90deg,rgba(79,241,214,.06),rgba(107,92,255,.05))}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .btn{background:var(--neon);color:#042428;border:none;border-radius:10px;padding:8px 12px;font-weight:800;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid var(--line);color:var(--muted)}
  .btn.sm{padding:6px 10px;font-size:13px}
  .muted{color:var(--muted);font-size:12px}
  .bar{height:8px;background:rgba(255,255,255,.06);border-radius:999px;overflow:hidden}
  .prog{height:100%;background:linear-gradient(90deg,var(--neon),var(--neon2));width:0%}
  .list{max-height:120px;overflow:auto;border-top:1px dashed var(--line);margin-top:8px;padding-top:8px}
  .file{font-size:12px;color:var(--muted)}
  .file strong{color:var(--neon)}
  .chip{background:rgba(255,255,255,.04);border:1px solid var(--line);padding:6px 8px;border-radius:8px;font-size:12px;color:var(--muted)}
  .results{display:flex;flex-direction:column;gap:10px}
  .box{border:1px solid var(--line);border-radius:10px;padding:10px;min-height:220px;max-height:520px;overflow:auto;background:linear-gradient(180deg,rgba(255,255,255,.02),transparent)}
  .pair{display:flex;justify-content:space-between;align-items:center;gap:8px;border:1px solid var(--line);border-radius:8px;padding:8px;margin-bottom:8px;background:rgba(255,255,255,.02)}
  .left{display:flex;align-items:center;gap:10px;min-width:0}
  .email{font-family:monospace;font-weight:900;color:var(--neon);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .pass{font-family:monospace;font-weight:800;color:var(--neon2)}
  .iconbtn{background:transparent;border:1px dashed var(--line);color:var(--muted);border-radius:8px;padding:6px 8px;cursor:pointer;font-size:12px}
  .footer{display:flex;justify-content:space-between;align-items:center}
  @media (max-width:1000px){ .wrap{grid-template-columns:1fr} }
  input[type=file]{display:none}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Email:Pass Grabber</h1>
      <span class="badge" id="total">0</span>
    </header>

    <!-- LEFT -->
    <section class="card">
      <label class="drop" id="drop">
        <input id="files" type="file" accept=".txt,.log,.csv,text/plain" multiple />
        <div><strong>Click or Drop Files</strong><div class="muted" style="margin-top:6px">Local-only • Multi-file</div></div>
      </label>

      <div class="row" style="margin-top:8px">
        <label class="muted"><input id="ok" type="checkbox"> I own or have permission to process these files</label>
      </div>

      <div class="row" style="margin-top:8px">
        <button class="btn sm" id="play">▶ Play</button>
        <button class="btn sm ghost" id="stop" disabled>■ Stop</button>
        <button class="btn sm ghost" id="clear">Clear</button>
      </div>

      <div style="margin-top:8px">
        <div class="bar"><div class="prog" id="prog"></div></div>
      </div>

      <div class="row" style="margin-top:8px">
        <label class="muted"><input id="onlyValid" type="checkbox"> Only valid emails</label>
        <label class="muted"><input id="mask" type="checkbox" checked> Mask passwords</label>
        <label class="muted"><input id="dedupe" type="checkbox" checked> Pro de-dupe</label>
      </div>

      <div class="row" style="margin-top:8px">
        <button class="btn sm" id="dlTxt">Download TXT</button>
        <button class="btn sm" id="dlCsv">Export CSV</button>
        <button class="btn sm" id="dlZip">ZIP (pairs + errors)</button>
        <button class="btn sm ghost" id="copyAll">Copy All</button>
      </div>

      <div class="list" id="queue"></div>
    </section>

    <!-- RIGHT -->
    <section class="card results">
      <div class="row" style="justify-content:space-between">
        <div class="muted">Grabbed</div>
        <div class="row">
          <span class="chip" id="validC">Valid: 0</span>
          <span class="chip" id="invalidC">Invalid: 0</span>
        </div>
      </div>

      <div class="box" id="box"><div class="muted" id="empty">No pairs yet.</div></div>

      <div class="footer">
        <div class="muted">Output enforced: <code>email:pass</code> (pass = letters+numbers only)</div>
        <div class="row">
          <button class="iconbtn" id="selectAll">Select all</button>
          <button class="iconbtn" id="deselectAll">Deselect</button>
          <button class="iconbtn" id="removeSel">Remove selected</button>
        </div>
      </div>
    </section>
  </div>

<script>
/* ===== DOM ===== */
const filesEl = document.getElementById('files');
const drop = document.getElementById('drop');
const ok = document.getElementById('ok');
const play = document.getElementById('play');
const stopBtn = document.getElementById('stop');
const clearBtn = document.getElementById('clear');
const prog = document.getElementById('prog');
const queueEl = document.getElementById('queue');
const onlyValid = document.getElementById('onlyValid');
const mask = document.getElementById('mask');
const dedupeChk = document.getElementById('dedupe');
const dlTxt = document.getElementById('dlTxt');
const dlCsv = document.getElementById('dlCsv');
const dlZip = document.getElementById('dlZip');
const copyAll = document.getElementById('copyAll');
const total = document.getElementById('total');
const box = document.getElementById('box');
const empty = document.getElementById('empty');
const validC = document.getElementById('validC');
const invalidC = document.getElementById('invalidC');
const selectAllBtn = document.getElementById('selectAll');
const deselectAllBtn = document.getElementById('deselectAll');
const removeSelBtn = document.getElementById('removeSel');

/* ===== State ===== */
let q = [];                  // File[]
let running = false, stopReq=false;
let pairs = [];              // {id,email,pass,valid,selected,source}
let errors = [];             // {source,line,content,reason}
let seq = 1;

/* ===== Utils ===== */
const EMAIL = /[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}/;
function isValidEmail(e){ return /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/i.test(e); }
function esc(s){ return String(s).replace(/[&<>"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }
function maskPass(s){ return s ? '•'.repeat(Math.min(12,s.length)) + (s.length>12 ? '…' : '') : ''; }

/* Pro email normalization for dedupe */
function normEmail(email){
  let [local, domain] = email.toLowerCase().split('@');
  if(!domain) return email.toLowerCase();
  if(domain === 'gmail.com' || domain === 'googlemail.com'){
    local = local.replace(/\./g,'').replace(/\+.*/,''); // dots ignored, remove +tag
    domain = 'gmail.com';
  } else if (/(outlook|hotmail|live)\.com$/.test(domain)){
    local = local.replace(/\+.*/,''); // plus tags common
  }
  return `${local}@${domain}`;
}
function keyFor(p){ return `${normEmail(p.email)}|${p.pass}`; }

function renderQueue(){
  queueEl.innerHTML = q.map(f=>`<div class="file"><strong>${esc(f.name)}</strong> — ${Math.round(f.size/1024)} KB <span style="float:right" id="st-${f._id}">queued</span></div>`).join('');
}
function counts(){
  total.textContent = pairs.length;
  const v = pairs.filter(x=>x.valid).length;
  validC.textContent = 'Valid: ' + v;
  invalidC.textContent = 'Invalid: ' + (pairs.length - v);
}
function render(){
  box.innerHTML = '';
  const showValid = onlyValid.checked;
  const list = pairs.filter(p => !showValid || p.valid);
  if(list.length === 0){ box.appendChild(empty); return; }
  for(const p of list){
    const row = document.createElement('div'); row.className='pair'; row.dataset.id=p.id;
    const left = document.createElement('div'); left.className='left';
    const cb = document.createElement('input'); cb.type='checkbox'; cb.checked=!!p.selected; cb.addEventListener('change', ()=> p.selected = cb.checked);
    const e = document.createElement('div'); e.className='email'; e.textContent=p.email;
    const ps = document.createElement('div'); ps.className='pass'; ps.textContent = mask.checked ? maskPass(p.pass) : p.pass;
    left.append(cb,e,ps);
    const right = document.createElement('div'); right.className='row';
    const copy = document.createElement('button'); copy.className='iconbtn'; copy.textContent='Copy';
    copy.onclick = async ()=>{ try{ await navigator.clipboard.writeText(`${p.email}:${p.pass}`); copy.textContent='Copied'; setTimeout(()=>copy.textContent='Copy',900);}catch{alert('Copy failed');}};
    const rm = document.createElement('button'); rm.className='iconbtn'; rm.textContent='Remove';
    rm.onclick = ()=>{ pairs = pairs.filter(x=>x.id!==p.id); if(dedupeChk.checked) dedupe(); counts(); render(); };
    right.append(copy,rm);
    row.append(left,right);
    box.appendChild(row);
  }
}

/* Strict grab: only email:pass where pass = [A-Za-z0-9]+, no prefixes like "623." and trims trailing junk. */
const STRICT_LINE = /([A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,})\s*[:=]\s*([A-Za-z0-9]+)/g;
/* also accept spaced colon "email : pass" */
const STRICT_LINE_SP = /([A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,})\s*:\s*([A-Za-z0-9]+)/g;

/* CSV header detect */
const CSV_HEAD = /(^|,|\t|\s)(email|e-mail|username)\b.*(,|\t|\s)(pass(word)?|pwd)\b/i;

async function parseText(text, source){
  let foundHere = 0;
  // 1) Global strict sweep
  for (const re of [STRICT_LINE, STRICT_LINE_SP]) {
    re.lastIndex = 0;
    let m; 
    while((m = re.exec(text)) !== null){
      const email = m[1].trim();
      const pass = m[2].trim(); // already alnum-only by regex
      if(!email || !pass) continue;
      const valid = isValidEmail(email);
      pushPair(email, pass, valid, source);
      foundHere++;
    }
  }

  // 2) CSV mode
  if(CSV_HEAD.test(text.slice(0,4096))){
    const lines = text.split(/\r?\n/);
    const header = (lines[0]||'').split(/,|\t/).map(s=>s.trim().toLowerCase());
    const ei = header.findIndex(h=>/^(email|e-mail|username)$/.test(h));
    const pi = header.findIndex(h=>/^(pass(word)?|pwd)$/.test(h));
    if(ei>-1 && pi>-1){
      for(let i=1;i<lines.length;i++){
        const cols = lines[i].split(/,|\t/);
        if(cols.length<=Math.max(ei,pi)) continue;
        let email = (cols[ei]||'').trim().replace(/^"|"$/g,'');
        let pass = (cols[pi]||'').trim().replace(/^"|"$/g,'');
        if(!email) continue;
        // enforce alnum-only pass
        const mpass = pass.match(/[A-Za-z0-9]+/);
        pass = mpass ? mpass[0] : '';
        if(!pass){ errors.push({source,line:i+1,content:lines[i],reason:'empty/non-alnum password (CSV)'}); continue; }
        const valid = isValidEmail(email);
        pushPair(email, pass, valid, source);
        foundHere++;
      }
    }
  }

  // 3) Rescue: if line has email but no strict pair, try grab nearest alnum token after ":" and log sanitization
  const lines = text.split(/\r?\n/);
  for(let i=0;i<lines.length;i++){
    const L = lines[i];
    if(!L) continue;
    const emails = L.match(new RegExp(EMAIL, 'g')) || [];
    for(const em of emails){
      // ignore leading numbering like "3651." by not using left side
      // look to the right of email for ":" or "=" then alnum token
      const idx = L.indexOf(em);
      const tail = L.slice(idx + em.length);
      const m = tail.match(/^\s*[:=]\s*([A-Za-z0-9]+)/);
      if(m){
        const email = em.trim();
        const pass = m[1].trim();
        const valid = isValidEmail(email);
        pushPair(email, pass, valid, source);
        foundHere++;
      } else {
        // got email but no acceptable pass → error
        errors.push({source,line:i+1,content:L,reason:'email without strict pass'});
      }
    }
  }

  return foundHere;
}

/* Push with cleaning: strip trailing junk from pass (already alnum), ensure output is email:pass only */
function pushPair(email, pass, valid, source){
  // clean obvious tails like "=> =>" by regex choice; also trim whitespace
  email = email.trim();
  pass  = pass.trim();

  // build object
  const obj = {id:seq++, email, pass, valid, selected:false, source};
  pairs.push(obj);
}

/* Pro de-dupe */
function dedupe(){
  const seen = new Set();
  const out = [];
  for(const p of pairs){
    const k = keyFor(p);
    if(!seen.has(k)){ seen.add(k); out.push(p); }
  }
  pairs = out;
}

/* ===== Queue & IO ===== */
drop.addEventListener('click', ()=> filesEl.click());
drop.addEventListener('dragover', e => { e.preventDefault(); drop.classList.add('drag'); });
drop.addEventListener('dragleave', e => { e.preventDefault(); drop.classList.remove('drag'); });
drop.addEventListener('drop', e => { e.preventDefault(); drop.classList.remove('drag'); addFiles([...e.dataTransfer.files||[]]); });
filesEl.addEventListener('change', e => addFiles([...e.target.files]));

function addFiles(arr){
  for(const f of arr){ f._id = Math.random().toString(36).slice(2,10)+Date.now().toString(36); q.push(f); }
  renderQueue();
}
function renderQueue(){ queueEl.innerHTML = q.map(f=>`<div class="file"><strong>${esc(f.name)}</strong> <span style="float:right" id="st-${f._id}">queued</span></div>`).join(''); }
function readText(f){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=e=>res(e.target.result); r.onerror=rej; r.readAsText(f); }); }

/* ===== Controls ===== */
play.addEventListener('click', async ()=>{
  if(running) return;
  if(!ok.checked){ alert('Please confirm permission.'); return; }
  if(q.length===0){ alert('No files queued.'); return; }
  running = true; stopReq=false; play.disabled=true; stopBtn.disabled=false;
  const total = q.length; let done=0;
  for(const f of q){
    if(stopReq) break;
    const st = document.getElementById(`st-${f._id}`); if(st) st.textContent='reading...';
    try{
      const txt = await readText(f);
      if(st) st.textContent='parsing...';
      await parseText(txt, f.name);
      if(st) st.textContent='done';
    }catch(e){
      if(st) st.textContent='error';
      errors.push({source:f.name,line:null,content:'<read failed>',reason:String(e)});
    }
    done++; prog.style.width = (done/total*100)+'%';
    if(dedupeChk.checked) dedupe();
    counts(); render();
    await new Promise(r=>setTimeout(r,120));
  }
  running=false; stopReq=false; play.disabled=false; stopBtn.disabled=true;
  q=[]; renderQueue();
});
stopBtn.addEventListener('click', ()=>{ stopReq=true; stopBtn.disabled=true; play.disabled=false; });
clearBtn.addEventListener('click', ()=> {
  if(!confirm('Clear queue, pairs, and errors?')) return;
  q=[]; pairs=[]; errors=[]; seq=1; prog.style.width='0%'; renderQueue(); counts(); render();
});

/* toggles */
onlyValid.addEventListener('change', ()=>{ render(); counts(); });
mask.addEventListener('change', render);
dedupeChk.addEventListener('change', ()=>{ if(dedupeChk.checked) dedupe(); render(); counts(); });

/* selection ops */
selectAllBtn.addEventListener('click', ()=> { for(const p of pairs) p.selected=true; render(); });
deselectAllBtn.addEventListener('click', ()=> { for(const p of pairs) p.selected=false; render(); });
removeSelBtn.addEventListener('click', ()=> {
  const any = pairs.some(p=>p.selected);
  if(!any) return alert('No selected rows.');
  if(!confirm('Remove selected rows?')) return;
  pairs = pairs.filter(p=>!p.selected);
  counts(); render();
});

/* ===== Exports ===== */
function currentList(){
  const v = onlyValid.checked;
  return pairs.filter(p => !v || p.valid);
}
dlTxt.addEventListener('click', ()=>{
  const list = currentList(); if(list.length===0) return alert('No pairs.');
  const txt = list.map(p=>`${p.email}:${p.pass}`).join('\n');
  const blob = new Blob([txt], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='pairs.txt'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});
dlCsv.addEventListener('click', ()=>{
  const list = currentList(); if(list.length===0) return alert('No pairs.');
  const csv = ['email,pass,valid,source', ...list.map(p=>`"${p.email.replace(/"/g,'""')}","${p.pass.replace(/"/g,'""')}",${p.valid},"${p.source}"`)].join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='pairs.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});
dlZip.addEventListener('click', async ()=>{
  const list = currentList();
  const zip = new JSZip();
  zip.file('pairs.txt', list.map(p=>`${p.email}:${p.pass}`).join('\n') || ''); 
  zip.file('pairs.csv', ['email,pass,valid,source', ...list.map(p=>`"${p.email.replace(/"/g,'""')}","${p.pass.replace(/"/g,'""')}",${p.valid},"${p.source}"`)].join('\n'));
  const errTxt = errors.length ? errors.map(e=>`[${e.source}${e.line?':'+e.line:''}] ${e.reason} :: ${e.content}`).join('\n') : 'No errors logged.';
  zip.file('errors.txt', errTxt);
  const summary = {
    total_pairs: pairs.length,
    pairs_in_zip: list.length,
    valid: pairs.filter(p=>p.valid).length,
    invalid: pairs.filter(p=>!p.valid).length,
    dedupe: !!dedupeChk.checked,
    only_valid_filter: !!onlyValid.checked,
    timestamp: new Date().toISOString()
  };
  zip.file('summary.json', JSON.stringify(summary,null,2));
  const blob = await zip.generateAsync({type:'blob'});
  saveAs(blob, 'grabbed_output.zip');
});
copyAll.addEventListener('click', async ()=>{
  const list = currentList(); if(list.length===0) return alert('No pairs.');
  const txt = list.map(p=>`${p.email}:${p.pass}`).join('\n');
  try{ await navigator.clipboard.writeText(txt); alert('Copied'); }catch{ prompt('Copy failed. Manual copy:', txt); }
});

/* ===== Boot ===== */
counts(); renderQueue(); render();
</script>
</body>
</html>
